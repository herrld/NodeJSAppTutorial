(function () {
    angular.module("app-manager", ["ngRoute"])
        .config(["$routeProvider","$locationProvider",function ($routeProvider, $locationProvider) {
            $routeProvider.when("/Application/Edit/:Id",
                {
                    controller: "applicationEditController",
                    controllerAs:"vm",
                    templateUrl: "/templates/application/edit.html"
                });
            $routeProvider.when("/Application",
                {
                    controller: "applicationController",
                    controllerAs: "vm",
                    templateUrl: "/templates/application/index.html"
                });
            
            $locationProvider.html5Mode(true);
        }]);
})();
///// <reference path="../../../lib/angular/angular.js" />
(function () {

    var injectParams = ["$http"];
    var appManagementService = function ($http) {
        var rootUrl = "api/AppData/"
        var saveUrl = rootUrl + "save";
        var getAllUrl = rootUrl;
        var startUrl = rootUrl;
        this.saveApp = function (app, callback) {
            $http.post(saveUrl, app)
                .then(function (data) {
                    callback(data);
                });

        }
        this.getAllApps = function (onSuccess) {
            $http.get(getAllUrl).then(onSuccess);
        }

        this.startApp = function (id, onSuccess) {
            $http.post(startUrl, id)
                .then(onSuccess);
        };
    };
    appManagementService.$inject = injectParams;
    angular.module("app-manager").service("appDataService", appManagementService);
})();
(function () {
    var injectParams = ["$http", "appDataService"];
    
    var applicationController = function($http, appDataService) {
        var vm = this;
        vm.applications;
        appDataService.getAllApps(function (response) {
            vm.applications = response.data;
        })
       
        vm.start = function (id) {
            appDataService.startApp(id, function (response) {
                alert("success")
            })
        };

        vm.create = function () {
            appDataService.saveApp({}, function () {
                alert("completed");
            });
        }
    }

    applicationController.$inject = injectParams;

    angular.module("app-manager").controller("applicationController", applicationController);
})();
(function () {
    var injectParams = ["$location", "$scope", "$http", "$routeParams", "appDataService"];
    
    var applicationEditController = function($location, $scope, $http, $routeParams, appDataService) {
        var vm = this;
        vm.Id = $routeParams.Id;
        vm.icons = [{ source: "images/ok-icon.png" }, { source: "images/ok-icon.png" }];
        $http.get("api/AppData/" + vm.Id)
            .then(function (response) {
                vm.data = response.data;
                vm.name = response.data.name;
                //vm.data.parameters = response.data.parameters;
            });

        vm.addParam = function () {
            if (!vm.data.parameters)
            {
                vm.data.parameters = [];
            }
            vm.data.parameters.push({ order: vm.data.parameters.length });
        };

        vm.save = function () {
            appDataService.saveApp(vm.data, function () {
                $location.path("/Application");
            });
        };

        vm.start = function () {
            appDataService.startById(vm.Id);
        };

        vm.removeParam = function (param) {
            var index = vm.data.parameters.indexOf(param);
            vm.data.parameters.splice(index, 1);
        };

    }

    applicationEditController.$inject = injectParams;
    angular.module("app-manager").controller("applicationEditController", applicationEditController);

})();